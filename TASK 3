using System;
using System.Collections.Generic;
using System.Text;
using System.Threading.Tasks;

namespace server
{
    class Program
    {
        static void Main(string[] args)
        {
            Database dataBase = new Database();
            dataBase.Work();
        }
    }

    class Database
    {
        private List<Player> _players = new List<Player>();

        public void ShowData()
        {
            for (int i = 0; i < _players.Count; i++)
            {
                Console.Write($"{i+1}-й игрок: ");
                _players[i].ShowPlayer();
                Console.WriteLine();
            }
        }

        public void Work()
        {
            Console.WriteLine("Выберите, что хотите сделать: 1 - добавить игрока 2 -  удалить игрока  3 - забанить/разбанить игрока по порядковому номеру4 - покинуть программу");
            string userInput = default;
            while (userInput!="4")
            {
                userInput = Console.ReadLine();
                switch (userInput)
                {
                    case "1":
                        AddPlayer();
                        Console.WriteLine("Выберите следующую команду");
                        break;
                    case "2":
                        RemovePlayer();
                        Console.WriteLine("Выберите следующую команду");
                        break;
                    case "3":
                        SetPlayerStatus();
                        Console.WriteLine("Выберите следующую команду");
                        break;
                    case "4":
                        Console.WriteLine("Вы покинули программу");
                        break;
                    default:
                        Console.WriteLine("Такого делать мы не умеем");
                        break;
                }
            }
        }

        private void AddPlayer()
        {
            int userInputNumber = SetIdentityNumber();

            Console.WriteLine("Введите никнейм игрока: ");
            string userInputNickname = Console.ReadLine();

            Console.WriteLine("Введите уровень игрока: ");
            int userInputLevel = GetNumber();
            Player player = new Player(userInputNumber, userInputNickname, userInputLevel);

            player.SetBanStatus();
            
            _players.Add(player);
            Console.WriteLine("Игрок добавлен");
        }

        private void RemovePlayer()
        {
            if (_players.Count <= 0)
            {
                Console.WriteLine("База данных пустая, попробуйте кого-то добавить");
            }
            else
            {
                _players.RemoveAt(FindPlayerByNumber());
                Console.WriteLine("Игрок удален, введите следующую команду");
            }
        }

        private int SetIdentityNumber()
        {
            int userInputNumber = default;
            bool isWorking = true;
            Console.WriteLine("Введите идентификационный номер игрока: ");
            do
            {
                userInputNumber = GetNumber();
                if (_players.Count == 0)
                {
                    isWorking = false;
                }
                else
                {
                    for (int i = 0; i < _players.Count; i++)
                    {
                        if (userInputNumber == _players[i]._identityNumber)
                        {
                            Console.WriteLine("такой идентификационный номер уже есть, попробуйте еще раз");
                        }
                        else
                        {
                            isWorking = false;
                        }
                    }
                }
            } 
            while (isWorking);
            return userInputNumber;
        }

        private void SetPlayerStatus()
        {
            if (_players.Count <= 0)
            {
                Console.WriteLine("База данных пустая, попробуйте кого-то добавить");
            }
            else
            {
                _players[FindPlayerByNumber()].SetBanStatus();
            }
        }

        private int GetNumber()
        {
            int userInput = default;
            bool isWorking = true;
            while (isWorking)
            {
                if (int.TryParse(Console.ReadLine(), out userInput))
                {
                    isWorking = false;
                }
                else
                {
                    Console.WriteLine("Введите число");
                }
            }
            return userInput;
        }

        private int FindPlayerByNumber()
        {
            int playerNumber = default;
            bool isWorking = true;
            while (isWorking)
            {
                ShowData();
                Console.WriteLine("Введите порядковый номер игрока, которого хотите удалить");
                playerNumber = GetNumber() - 1;
                if (playerNumber < _players.Count && playerNumber > -1)
                {
                    isWorking = false;
                }
                else
                {
                    Console.WriteLine("Вам нужно ввести номер уже существующего игрока");
                }
            }
            return playerNumber;
        }

    }

    class Player
    {
        private string _nickname;
        private bool _isBanned;
        private int _level;

        public int _identityNumber { get; private set; }

        public Player(int number, string nickname, int level)
        {
            _identityNumber = number;
            _nickname = nickname;
            _level = level;
        }

        public void ShowPlayer()
        {
            Console.Write($"Номер игрока - {_identityNumber}\t Ник - {_nickname}\t Статус бана - {_isBanned}\t Уровень - {_level} ");
        }

        public void SetBanStatus()
        {
            Console.WriteLine("Статус бана игрока, напишите: да(забанен)или нет(незабанен)");
            string inputPlayerStatus = default;
            while (inputPlayerStatus != "да" && inputPlayerStatus != "нет")
            {
                inputPlayerStatus = Console.ReadLine();
                if (inputPlayerStatus == "да")
                {
                    _isBanned = true;
                }
                else if (inputPlayerStatus == "нет")
                {
                    _isBanned = false;
                }
                else
                {
                    Console.WriteLine("Ошибка ввода, попробуйте еще раз");
                }
            }
        }
    }
}
