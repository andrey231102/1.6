using System;
using System.Collections.Generic;
using System.Text;
using System.Threading.Tasks;

namespace CarService
{
  
    class Program
    {
        static void Main(string[] args)
        {
            AutoService autoService = new AutoService();
            autoService.CreateCar(15);
            autoService.Work();
        }
    }

    class AutoService
    {
        private Dictionary<string, int> _wareHouse = new Dictionary<string, int>();
        public void CreateWarehouse()
        {
            _wareHouse.Add("руль", 5);
            _wareHouse.Add("коробка передач", 5);
            _wareHouse.Add("радио", 5);
            _wareHouse.Add("двигатель", 5);
            _wareHouse.Add("ходовая", 5);
            _wareHouse.Add("краска", 5);
            _wareHouse.Add("печка", 5);
            _wareHouse.Add("кондиционер", 5);
        }

        private Queue<Car> _brokenCars = new Queue<Car>();
        public void CreateCar(int amountOfBrokenCars)
        {
            for (int i = 0; i < amountOfBrokenCars; i++)
            {
                Car car = new Car();
                car.BreakDown();
                _brokenCars.Enqueue(car);
            }
        }

        public void Work()
        {
            CreateWarehouse();
            while (_brokenCars.Count>0)
            {
                Car car = _brokenCars.Dequeue();
                car.ShowBrokenDetails();
                ReplacePart(car);
                Console.WriteLine("Нажмите любую кнопку чтобы перейти к следующему покупателю");
                //Console.ReadLine();
            }
        }

        public void ReplacePart(Car car)
        {
            for (int i = 0; i < car._brokenParts.Count; i++)
            {
                if (_wareHouse.ContainsKey(car._brokenParts[i].Name) && _wareHouse[car._brokenParts[i].Name] >0 )
                {
                    Console.WriteLine($"Деталь {car._brokenParts[i].Name} заменена");
                    _wareHouse[car._brokenParts[i].Name]--;
                }
                else
                {
                    Console.WriteLine($"деталь {car._brokenParts[i].Name} отсутствует на складе");
                }
            }
        }
    }

    class Car
    {
        private Random _random = new Random();
        private List<Detail> _spareParts = new List<Detail> 
        { 
            new Detail("руль", 200), 
            new Detail("коробка передач", 300), 
            new Detail("радио", 250), 
            new Detail("двигатель", 800),
            new Detail("ходовая", 500),
            new Detail("краска", 100),
            new Detail("печка", 400),
            new Detail("кондиционер", 450),
        };
        public List<Detail> _brokenParts = new List<Detail>();

        public void BreakDown()
        {
            int amountOfBrokenDetails = _random.Next(1, _spareParts.Count);
            for (int i = 0; i < amountOfBrokenDetails; i++)
            {
                _brokenParts.Add(_spareParts[_random.Next(0, _spareParts.Count)]);
            }
            for (int i = 0; i < _brokenParts.Count-1; i++)
            {
                for (int t = 1; t < _brokenParts.Count; t++)
                {
                    if (_brokenParts[i]==_brokenParts[t] && t >i)
                    {
                        _brokenParts.RemoveAt(t);
                    }
                    else if(_brokenParts[i] == _brokenParts[t] && t < i)
                    {
                        _brokenParts.RemoveAt(i);
                    }
                }
            }
        }

        public void ShowBrokenDetails()
        {
            Console.WriteLine("Мне нужно починить: ");
            foreach (var brokenPart in _brokenParts)
            {
                Console.WriteLine(brokenPart.Name + " " + brokenPart.RepairCost);
            }
        }
    }

    class Detail
    {
        public string Name { get; private set; } 
        public int RepairCost { get; private set; }

        public Detail(string name, int repairCost)
        {
            Name = name;
            RepairCost = repairCost;
        }

        public void ShowInfo()
        {
            Console.WriteLine(Name + " - " + RepairCost + " денег");
        }
    }
}
